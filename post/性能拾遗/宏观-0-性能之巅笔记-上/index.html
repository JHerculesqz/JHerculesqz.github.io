<!doctype html><html lang=zh-cn itemscope itemtype=http://schema.org/WebPage><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><title>【宏观】-0-性能之巅笔记-上 - 妙木山</title><meta name=renderer content="webkit"><meta name=viewport content="width=device-width,initial-scale=1,user-scalable=yes"><meta name=MobileOptimized content="width"><meta name=HandheldFriendly content="true"><meta name=applicable-device content="pc,mobile"><meta name=theme-color content="#f8f5ec"><meta name=msapplication-navbutton-color content="#f8f5ec"><meta name=apple-mobile-web-app-capable content="yes"><meta name=apple-mobile-web-app-status-bar-style content="#f8f5ec"><meta name=mobile-web-app-capable content="yes"><meta name=author content="猴王无敌"><meta name=description content="1.Brendan Gregg是谁 Brendan Gregg，性能界大神，曾就职于Netflix、Sun、Oracle、Joyent(被三星收购的一家云计算公司)，从202"><meta name=keywords content="Hugo,theme,jane"><meta name=generator content="Hugo 0.74.2"><link rel=canonical href=https://jherculesqz.github.io/post/%E6%80%A7%E8%83%BD%E6%8B%BE%E9%81%97/%E5%AE%8F%E8%A7%82-0-%E6%80%A7%E8%83%BD%E4%B9%8B%E5%B7%85%E7%AC%94%E8%AE%B0-%E4%B8%8A/><link rel=icon href=/favicon.ico><link rel=stylesheet href=/sass/jane.min.b3a8813c06e6d785beba22bf8264e174fa2cb3a396b22f9ba24e2c00c18aaf7f.css integrity="sha256-s6iBPAbm14W+uiK/gmThdPoss6OWsi+bok4sAMGKr38=" media=screen crossorigin=anonymous><meta property="og:title" content="【宏观】-0-性能之巅笔记-上"><meta property="og:description" content="1.Brendan Gregg是谁 Brendan Gregg，性能界大神，曾就职于Netflix、Sun、Oracle、Joyent(被三星收购的一家云计算公司)，从202"><meta property="og:type" content="article"><meta property="og:url" content="https://jherculesqz.github.io/post/%E6%80%A7%E8%83%BD%E6%8B%BE%E9%81%97/%E5%AE%8F%E8%A7%82-0-%E6%80%A7%E8%83%BD%E4%B9%8B%E5%B7%85%E7%AC%94%E8%AE%B0-%E4%B8%8A/"><meta property="article:published_time" content="2022-05-25T10:00:59+08:00"><meta property="article:modified_time" content="2022-05-25T10:00:59+08:00"><meta itemprop=name content="【宏观】-0-性能之巅笔记-上"><meta itemprop=description content="1.Brendan Gregg是谁 Brendan Gregg，性能界大神，曾就职于Netflix、Sun、Oracle、Joyent(被三星收购的一家云计算公司)，从202"><meta itemprop=datePublished content="2022-05-25T10:00:59+08:00"><meta itemprop=dateModified content="2022-05-25T10:00:59+08:00"><meta itemprop=wordCount content="4539"><meta itemprop=keywords content="性能拾遗-宏观,"><meta name=twitter:card content="summary"><meta name=twitter:title content="【宏观】-0-性能之巅笔记-上"><meta name=twitter:description content="1.Brendan Gregg是谁 Brendan Gregg，性能界大神，曾就职于Netflix、Sun、Oracle、Joyent(被三星收购的一家云计算公司)，从202"><!--[if lte IE 9]><script src=https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js></script><![endif]--><!--[if lt IE 9]><script src=https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js></script><script src=https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js></script><![endif]--></head><body><div id=mobile-navbar class=mobile-navbar><div class=mobile-header-logo><a href=/ class=logo>妙木山</a></div><div class=mobile-navbar-icon><span></span><span></span><span></span></div></div><nav id=mobile-menu class="mobile-menu slideout-menu"><ul class=mobile-menu-list><li class=mobile-menu-item><a class=menu-item-link href=https://jherculesqz.github.io/>首页</a></li><li class=mobile-menu-item><a class=menu-item-link href=https://jherculesqz.github.io/categories/>技术专栏</a></li><li class=mobile-menu-item><a class=menu-item-link href=https://jherculesqz.github.io/tags/>Tags</a></li><li class=mobile-menu-item><a class=menu-item-link href=https://jherculesqz.github.io/post/>全部文章</a></li><li class=mobile-menu-item><a class=menu-item-link href=https://jherculesqz.github.io/about/>关于</a></li></ul></nav><link rel=stylesheet href=/lib/photoswipe/photoswipe.min.css><link rel=stylesheet href=/lib/photoswipe/default-skin/default-skin.min.css><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)"></button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><header id=header class="header container"><div class=logo-wrapper><a href=/ class=logo>妙木山</a></div><nav class=site-navbar><ul id=menu class=menu><li class=menu-item><a class=menu-item-link href=https://jherculesqz.github.io/>首页</a></li><li class=menu-item><a class=menu-item-link href=https://jherculesqz.github.io/categories/>技术专栏</a></li><li class=menu-item><a class=menu-item-link href=https://jherculesqz.github.io/tags/>Tags</a></li><li class=menu-item><a class=menu-item-link href=https://jherculesqz.github.io/post/>全部文章</a></li><li class=menu-item><a class=menu-item-link href=https://jherculesqz.github.io/about/>关于</a></li></ul></nav></header><div id=mobile-panel><main id=main class="main bg-llight"><div class=content-wrapper><div id=content class="content container"><article class="post bg-white"><header class=post-header><h1 class=post-title>【宏观】-0-性能之巅笔记-上</h1><div class=post-meta><time datetime=2022-05-25 class=post-time>2022-05-25</time><div class=post-category><a href=https://jherculesqz.github.io/categories/%E6%80%A7%E8%83%BD%E6%8B%BE%E9%81%97/>性能拾遗</a></div><span class=more-meta>约 4539 字</span>
<span class=more-meta>预计阅读 10 分钟</span>
<span id=busuanzi_container_page_pv>| 阅读 <span id=busuanzi_value_page_pv></span></span></div></header><div class=post-toc id=post-toc><h2 class=post-toc-title>文章目录</h2><div class=post-toc-content><nav id=TableOfContents><ul><li><a href=#1brendan-gregg是谁>1.Brendan Gregg是谁</a></li><li><a href=#2第一章笔记>2.第一章笔记</a><ul><li><a href=#为什么学习性能工程很难>为什么学习性能工程很难？</a></li><li><a href=#为什么实施性能工程很难>为什么实施性能工程很难？</a><ul><li><a href=#性能的主观性>性能的主观性</a></li><li><a href=#系统的复杂性>系统的复杂性</a></li><li><a href=#人员的协作性>人员的协作性</a></li></ul></li></ul></li><li><a href=#3第二章笔记>3.第二章笔记</a><ul><li><a href=#开展性能工程的21种方法>开展性能工程的21种方法</a><ul><li><a href=#街灯讹方法>街灯讹方法</a></li><li><a href=#责怪他人讹方法>责怪他人讹方法</a></li><li><a href=#赤果果的调侃>赤果果的调侃</a></li></ul></li><li><a href=#被测系统的架构>被测系统的架构</a></li><li><a href=#被测系统的模型>被测系统的模型</a></li><li><a href=#性能工程的2种分析视角>性能工程的2种分析视角</a></li><li><a href=#性能指标>性能指标</a></li><li><a href=#性能工程涉及的数学模型>性能工程涉及的数学模型</a><ul><li><a href=#amdahl扩展定律>Amdahl扩展定律</a></li><li><a href=#通用扩展定律>通用扩展定律</a></li><li><a href=#排队论>排队论</a></li><li><a href=#基本统计指标>基本统计指标</a></li></ul></li></ul></li><li><a href=#4第一章第二章小结>4.第一章/第二章小结</a></li><li><a href=#5参考文献>5.参考文献</a></li></ul></nav></div></div><div class=post-content><h1 id=1brendan-gregg是谁>1.Brendan Gregg是谁</h1><p>Brendan Gregg，性能界大神，曾就职于Netflix、Sun、Oracle、Joyent(被三星收购的一家云计算公司)，从2022年5月的博客看，他目前就职于Intel。</p><p>Brendan Gregg在性能方面的成就数不胜数，仅列出两项就可以让我们膜拜了：</p><ul><li><strong>《Systems Performance : Enterprise and the Cloud》</strong>：中文名《性能之巅》，一本风靡全球的性能工程的圣经。</li></ul><p><img src=/%E6%80%A7%E8%83%BD%E6%8B%BE%E9%81%97/%E3%80%90%E5%AE%8F%E8%A7%82%E3%80%91-0-%E6%80%A7%E8%83%BD%E4%B9%8B%E5%B7%85%E7%AC%94%E8%AE%B0-%E4%B8%8A/image-20220526101942669.png alt=image-20220526101942669></p><ul><li><strong>&ldquo;The Flame Graph&rdquo;</strong>：Brendan Gregg于2013年提出的"火焰图&rdquo;，火焰图方法也成为现在各种性能工具中必备的可视化能力。</li></ul><p><img src=/%E6%80%A7%E8%83%BD%E6%8B%BE%E9%81%97/%E3%80%90%E5%AE%8F%E8%A7%82%E3%80%91-0-%E6%80%A7%E8%83%BD%E4%B9%8B%E5%B7%85%E7%AC%94%E8%AE%B0-%E4%B8%8A/image-20220526103724186.png alt=image-20220526103724186></p><p>Brendan Gregg在性能领域，还有一个被广为传播的骚操作——对着磁盘狂吼引发磁盘IO的性能问题。。。大神的世界我们永远不懂。。。</p><ul><li>油管：<a href="https://www.youtube.com/watch?v=tDacjrSCeq4">https://www.youtube.com/watch?v=tDacjrSCeq4</a></li><li>B站：<a href=https://www.bilibili.com/video/BV1gY4y1L7Px/>https://www.bilibili.com/video/BV1gY4y1L7Px/</a></li></ul><p><img src=/%E6%80%A7%E8%83%BD%E6%8B%BE%E9%81%97/%E3%80%90%E5%AE%8F%E8%A7%82%E3%80%91-0-%E6%80%A7%E8%83%BD%E4%B9%8B%E5%B7%85%E7%AC%94%E8%AE%B0-%E4%B8%8A/image-20220526105433607.png alt=image-20220526105433607></p><h1 id=2第一章笔记>2.第一章笔记</h1><p>Brendan Gregg在《性能之巅》第一章主要讲了2个问题：</p><ul><li>为什么学习性能工程很难？</li><li>为什么实施性能工程很难？</li></ul><h2 id=为什么学习性能工程很难>为什么学习性能工程很难？</h2><p>作者想表达的核心观点：</p><ul><li><p>性能工程要求工程师具备宽广的技术广度，同时也要具备深邃的技术深度。</p></li><li><p>然而，技术深度与技术广度兼备的确是一件很困难的事情。</p></li></ul><p>作者引用了2002年美国国防部长论述国际关系时的一段话：</p><blockquote><p>国际关系中，</p><p>有已知的已知：有些事情我们知道自己知道。</p><p>也有已知的未知：我们知道有些事情我们不知道。</p><p>但还有未知的未知：有些事情我们知道自己不知道。</p></blockquote><p>美国防部长这段话的本意是想论述国际关系复杂多变，任何一项决策要考虑充分，避免未知的未知引发不可估量的后果。</p><p>作者认为这段话也可以类比于性能工程：</p><blockquote><p>当我们开展性能优化工作时，由于未知的未知太多，会导致：</p><p>(1)缺乏"高效"的定位手段——而且我们还不自知操作系统早已为我们准备好了对应的方法和工具。</p><p>(2)缺乏"有效"的解决办法。</p></blockquote><p>作者的观点，与庄子的《养生主》异曲同工：</p><blockquote><p>吾生也有涯，而知也无涯。以有涯随无涯，殆已！</p></blockquote><p>人类的生命是非常有限的，而知识无边无尽，以有限的生命追求无边的知识，显然是不可能的。</p><p>作者有什么建议呢？可以归纳为两点：</p><ul><li>对策1：对知识进行归纳，抽象出知识的本质。</li><li>对策2：有选择地、有优先级地学习。<ul><li>巩固已知的已知，扩大已知的未知，减少未知的未知。</li></ul></li></ul><p>作者认为知识肯定是学不完的，但学习时可以：</p><ul><li>首先，将尽可能多的"未知的未知"转换为"已知的未知&rdquo;。</li><li>然后，实战时再查资料，将"已知的未知"转换为"已知的已知&rdquo;。</li></ul><p><img src=/%E6%80%A7%E8%83%BD%E6%8B%BE%E9%81%97/%E3%80%90%E5%AE%8F%E8%A7%82%E3%80%91-0-%E6%80%A7%E8%83%BD%E4%B9%8B%E5%B7%85%E7%AC%94%E8%AE%B0-%E4%B8%8A/image-20220526162559859.png alt=image-20220526162559859></p><p>但，工程师分三种：</p><ul><li><p>天才型工程师：知识结构大多是已知的已知，这是大神，也是少数。</p></li><li><p>扎实型工程师：知识结构大多是已知的已知、已知的未知，这是大多数人的可能达到的状态。</p></li><li><p>愚昧型工程师：知识结构大多是未知的知识，这种工程师往往觉得自己就是全世界。</p></li></ul><p>&ldquo;<strong>用到的时候再查文档</strong>&ldquo;这句话，</p><p>对于扎实性工程师是有效的。</p><p>对于愚昧性工程师是无效的——即便实战时给他充足的时间查资料，首先他都不会去查(因为他不知道)，即便去查也可能查不到、查到也看不懂。</p><p>作者的这个学习论，可以推广到各种知识的学习中。</p><h2 id=为什么实施性能工程很难>为什么实施性能工程很难？</h2><p>作者归纳了实战中性能工程的3个难点：</p><ul><li>性能的主观性</li><li>系统的复杂性</li><li>人员的协作性</li></ul><h3 id=性能的主观性>性能的主观性</h3><p>作者认为性能是主观的，同样是<code>磁盘单次IO的时间是1ms</code>，</p><p>在实时系统场景下是很慢的，在管理信息系统场景下却是很快的。</p><p>因此，性能工程要结合实际产品制定合理、合适的性能标准。</p><h3 id=系统的复杂性>系统的复杂性</h3><p>作者认为<strong>被测系统是复杂的</strong>，进而<strong>导致2个问题</strong>：</p><ul><li>寻找性能问题时，找不到分析的<strong>起点</strong>。<ul><li>很多性能培训案例，是假定我们已知问题起点了。</li><li>比如：假定我们已经知道就是进程A的线程B疑似死锁了，于是演示各种工具如何证明是死锁。</li><li>关键我们怎么知道就是进程A有性能问题？怎么知道就是线程B有问题？怎么知道就是死锁问题？</li></ul></li><li>解决性能问题时，往往<strong>牵一发而动全身</strong>。<ul><li>修改死锁问题，可能CPU的瓶颈没有了。</li><li>但，应用程序继续往下一个环节运行，又引发了IO的瓶颈。</li><li>所以才有程序猿感慨：&ldquo;时间是不可能被消灭的，只可能被转移。&ldquo;<img src=/性能拾遗/【宏观】-0-性能之巅笔记-上/image-20220526172626038.png alt=image-20220526172626038 style=zoom:25%></li></ul></li></ul><h3 id=人员的协作性>人员的协作性</h3><p>作者根据经验总结了3个与人相关的问题：</p><ul><li>性能工程涉及到产品研发体系的众多角色。比如：系统管理员、应用开发者、DBA、网络工程师。</li><li>角色间的部门墙可能导致性能工程断点。</li><li>即使是性能工程师，也可能专注于某个领域。比如：Java性能工程师、MySQL性能工程师等。</li></ul><p>看来在哪儿都有部门墙，有人的地方就有江湖。</p><p><img src=/%E6%80%A7%E8%83%BD%E6%8B%BE%E9%81%97/%E3%80%90%E5%AE%8F%E8%A7%82%E3%80%91-0-%E6%80%A7%E8%83%BD%E4%B9%8B%E5%B7%85%E7%AC%94%E8%AE%B0-%E4%B8%8A/image-20220527103458466.png alt=image-20220527103458466></p><h1 id=3第二章笔记>3.第二章笔记</h1><p>Brendan Gregg在《性能之巅》第二章主要从6个方面讲了性能工程的方法论：</p><ul><li>开展性能工程的21种方法</li><li>被测系统的架构</li><li>被测系统的模型</li><li>性能工程的2种分析视角</li><li>性能指标</li><li>性能工程涉及的数学模型</li></ul><h2 id=开展性能工程的21种方法>开展性能工程的21种方法</h2><p>作者在这一段讲了21种性能工程常用的方法(英文<code>anti-methodologies</code>)，译者生造了个词——<code>讹方法</code>。</p><p><code>讹方法</code>？难道是<code>讹人</code>的意思？我选了两种方法说明一下：</p><h3 id=街灯讹方法>街灯讹方法</h3><p>作者讲了个故事：</p><blockquote><p>有个醉汉在路灯下找钥匙，警察帮忙找了半天也没找到。</p><p>警察问醉汉确不确定就在这个路灯下丢的钥匙。</p><p>醉汉说：我也不确定，但是这里是最亮的。</p></blockquote><p>这。。。</p><p>不就是某些程序猿定位性能问题但找不到切入点时，先随便怀疑一段代码，碰碰运气吗。。。</p><h3 id=责怪他人讹方法>责怪他人讹方法</h3><p>作者说了一下操作步骤：</p><blockquote><p>第一步、找到一个不是自己负责的模块——注意，一定不是自己负责的模块！</p><p>第二步、假定问题就是这个模块造成的。</p><p>第三步、把问题扔给那个模块的负责人。</p><p>第四步、如果那个模块的负责人证明不是他的问题，重复步骤1。</p></blockquote><p>这。。。</p><p>不就是某些程序猿最喜欢干的事儿吗——甩锅大法！！！</p><p>Brendan Gregg竟然给甩锅大法取了这么牛X的名字，还给出了甩锅的详细步骤。。。</p><p><img src=/%E6%80%A7%E8%83%BD%E6%8B%BE%E9%81%97/%E3%80%90%E5%AE%8F%E8%A7%82%E3%80%91-0-%E6%80%A7%E8%83%BD%E4%B9%8B%E5%B7%85%E7%AC%94%E8%AE%B0-%E4%B8%8A/image-20220527120219336.png alt=image-20220527120219336></p><h3 id=赤果果的调侃>赤果果的调侃</h3><p>行了，这一段儿基本可以跳过了。。。</p><p>这一段儿就是作者一本正经地调侃。。。</p><p>当然，以作者的骚气，他在这么权威的书里面写出这种段子，我们也不应该太意外。。。</p><p><img src=/%E6%80%A7%E8%83%BD%E6%8B%BE%E9%81%97/%E3%80%90%E5%AE%8F%E8%A7%82%E3%80%91-0-%E6%80%A7%E8%83%BD%E4%B9%8B%E5%B7%85%E7%AC%94%E8%AE%B0-%E4%B8%8A/image-20220527114756476.png alt=image-20220527114756476></p><h2 id=被测系统的架构>被测系统的架构</h2><p>作者表达了1个观点和1个常用的架构：</p><ul><li><strong>1个观点</strong>：性能工程是针对整个系统(包括所有硬件和软件栈)，实施性能工程前画出完整的架构图可以避免<code>只见树木不见森林</code>。</li><li><strong>1个常用架构</strong>：如下图。</li></ul><p><img src=/%E6%80%A7%E8%83%BD%E6%8B%BE%E9%81%97/%E3%80%90%E5%AE%8F%E8%A7%82%E3%80%91-0-%E6%80%A7%E8%83%BD%E4%B9%8B%E5%B7%85%E7%AC%94%E8%AE%B0-%E4%B8%8A/image-20220527121255677.png alt=image-20220527121255677></p><h2 id=被测系统的模型>被测系统的模型</h2><ul><li><strong>SUT模型</strong>：system under test</li></ul><p><img src=/%E6%80%A7%E8%83%BD%E6%8B%BE%E9%81%97/%E3%80%90%E5%AE%8F%E8%A7%82%E3%80%91-0-%E6%80%A7%E8%83%BD%E4%B9%8B%E5%B7%85%E7%AC%94%E8%AE%B0-%E4%B8%8A/image-20220527121828041.png alt=image-20220527121828041></p><ul><li><strong>排队系统</strong>：这个模型很重要，作者贯穿全书的理念就是能将所有的性能问题都归纳为排队系统。</li></ul><p><img src=/%E6%80%A7%E8%83%BD%E6%8B%BE%E9%81%97/%E3%80%90%E5%AE%8F%E8%A7%82%E3%80%91-0-%E6%80%A7%E8%83%BD%E4%B9%8B%E5%B7%85%E7%AC%94%E8%AE%B0-%E4%B8%8A/image-20220527122023060.png alt=image-20220527122023060></p><h2 id=性能工程的2种分析视角>性能工程的2种分析视角</h2><p>在梳理好被测系统的架构后，我们有两种选择：</p><ul><li><strong>自下而上</strong>：resource analysis，从硬件、内核、系统调用寻找资源瓶颈，进而定位到应用程序的进程、线程。</li><li><strong>自上而下</strong>：workload analysis，从应用程序出发，找到资源瓶颈。</li></ul><p>作者认为，其实两种分析视角要结合起来，才是最有效的性能工程方法。</p><p><img src=/%E6%80%A7%E8%83%BD%E6%8B%BE%E9%81%97/%E3%80%90%E5%AE%8F%E8%A7%82%E3%80%91-0-%E6%80%A7%E8%83%BD%E4%B9%8B%E5%B7%85%E7%AC%94%E8%AE%B0-%E4%B8%8A/image-20220527122439419.png alt=image-20220527122439419></p><h2 id=性能指标>性能指标</h2><p>对于常用的性能指标就不展开了。如：延时、响应时间、时间量级、使用率、饱和度等。</p><p>作者重点展开了对<strong>缓存的基础知识</strong>介绍：</p><ul><li><strong>什么是缓存</strong>？</li></ul><blockquote><p>将数据不再存储在较慢的存储层，而是将数据存储到较快的存储层中。</p></blockquote><ul><li><strong>典型的缓存</strong>？</li></ul><blockquote><p>CPU的L1、L2、L3缓存</p></blockquote><ul><li><strong>缓存的命中率是什么</strong>？</li></ul><blockquote><p>命中率 = 命中次数 / (命中次数+失效次数)</p></blockquote><ul><li><strong>失效率是什么</strong>？</li></ul><blockquote><p>每秒缓存失效次数</p></blockquote><ul><li><strong>命中率、失效率与运行性能的关系</strong>？</li></ul><blockquote><p>运行时间 = 命中率 * 命中延时 + 失效率 * 失效延时</p><p>比如：</p><p>任务1的命中率很高(90%)，失效率也很高(200/s)。</p><p>任务2的命中率略低(80%)，失效率也很低(20/s)。</p><p>那么，最终任务2的性能会更好。</p></blockquote><ul><li><strong>实现缓存的算法有哪些</strong>？</li></ul><blockquote><p>MRU：将最近最长使用的数据保留在缓存中。</p><p>LRU：将最近最少使用的数据移出缓存。</p><p>其它算法还有NFU、MFU、LFU。</p></blockquote><ul><li><strong>缓存温度有哪些</strong>？</li></ul><blockquote><p>冷：命中率无限接近于0，比如缓存是空的。</p><p>热：命中率无限接近于预期的高度。</p><p>温：命中率还没有达到预期的高度。比如：缓存中存了一定有用的数据，但不全是有用的数据。</p></blockquote><p>大白话一点，缓存机制的本质和海王海后的鱼塘逻辑差不多：</p><ul><li><strong>MRU、LRU</strong>：MRU——最近经常撩的，加到鱼塘里、LRU——最近不咋联系的，踢出鱼塘。</li><li><strong>命中率高、失效率低，性能好</strong>：鱼塘里都是鱼，鱼还很活跃，随便撩一下都是鱼，你说那啥效率高不高？</li></ul><p><img src=/%E6%80%A7%E8%83%BD%E6%8B%BE%E9%81%97/%E3%80%90%E5%AE%8F%E8%A7%82%E3%80%91-0-%E6%80%A7%E8%83%BD%E4%B9%8B%E5%B7%85%E7%AC%94%E8%AE%B0-%E4%B8%8A/image-20220527150414981.png alt=image-20220527150414981></p><h2 id=性能工程涉及的数学模型>性能工程涉及的数学模型</h2><h3 id=amdahl扩展定律>Amdahl扩展定律</h3><p>由计算机科学家阿姆达尔，在1967年AFIPS春季联合计算机会议上提出。</p><p>这个阿姆达尔扩展定律的目的是为了预测性能优化到什么程度。</p><p>阿姆达尔定律本质上用严谨的公式证明了"木桶原理&rdquo;——无法优化的那个部件决定了性能优化的上线。</p><p>如果：1个单线程的程序需要20小时，其中有1个小时无法并行化处理，</p><p>那么：将剩余19小时并行化了，最短执行时间也不可能小于1小时。</p><p>因此：我们就可以预测性能优化后可以加速20倍。</p><p>道理很通俗，但科学家需要严谨的公式推导，详细推导过程可以看看维基百科：</p><blockquote><p><a href=https://en.wikipedia.org/wiki/Amdahl%27s_law>https://en.wikipedia.org/wiki/Amdahl%27s_law</a></p></blockquote><p>但阿姆达尔定律有一个缺陷：以上述案例，是不是我们19个小时的任务并行化，就一定可以将性能优化到1小时呢？</p><p>显然不是——随着CPU增加，可能会达到一个瓶颈点，随后无论怎么增加CPU，性能也不会优化了。</p><p><img src=/%E6%80%A7%E8%83%BD%E6%8B%BE%E9%81%97/%E3%80%90%E5%AE%8F%E8%A7%82%E3%80%91-0-%E6%80%A7%E8%83%BD%E4%B9%8B%E5%B7%85%E7%AC%94%E8%AE%B0-%E4%B8%8A/image-20220527160717677.png alt=image-20220527160717677></p><h3 id=通用扩展定律>通用扩展定律</h3><p>通用扩展定律：Universal Scalability Law，USL。由计算机科学家Neil J. Gunther于2008年提出。</p><p>这个定律就是用来更加精细化地预测：当我持续增加资源，实际的性能优化与阿姆达尔定律的理想化性能优化的偏移量。</p><p><img src=/%E6%80%A7%E8%83%BD%E6%8B%BE%E9%81%97/%E3%80%90%E5%AE%8F%E8%A7%82%E3%80%91-0-%E6%80%A7%E8%83%BD%E4%B9%8B%E5%B7%85%E7%AC%94%E8%AE%B0-%E4%B8%8A/image-20220527161219066.png alt=image-20220527161219066></p><h3 id=排队论>排队论</h3><p><a href=https://en.wikipedia.org/wiki/Agner_Krarup_Erlang>Agner Krarup Erlang</a>于1909年第一次提出了排队理论。</p><p>排队论描述了现实世界中有形、无形的各种排队场景。比如：12306抢票、网红店取号排队、超市排队买单等。</p><p>顾客肯定希望排队越短越好、办事儿时间越快越好。超市安排过多的收银员就浪费了，安排太少的收银员又会被顾客投诉。</p><p>顾客肯定不是按顺序一个个来超市，有可能在一个热点时间一拥而上来超市。</p><p>超市的排队规则是先到先处理，但是车牌摇号就是随机处理了。</p><p>……</p><p>上述这些，就是排队论研究的内容：</p><ul><li><strong>被服务者的到达遵循何种分布</strong>：如泊松分布。</li><li><strong>服务机构的服务能力遵循何种统计特征</strong>：如每个收银员的处理速度。</li><li><strong>排队的原则是什么</strong>：如先到先处理or随机处理。</li><li><strong>排队的Topo结构</strong>：如超市最多放下10个收银台，那就有10条并行的排队结构。</li></ul><p>最终排队论给出评估：</p><ul><li><strong>怎么排队，收益最大</strong>。</li></ul><p>Brendan Gregg的核心观点是：</p><ul><li>无论应用程序，还是CPU、IO、网络、磁盘都可以用排队模型化。</li><li>按照排队论，多种性能优化手段，最终一定有一个从"运筹学"上性能收益最大的选择。</li></ul><p>理解排队论的推导，对于笔者还很困难，各位读者有兴趣可以参考相关资料：</p><blockquote><p><a href=https://zh.m.wikipedia.org/zh-sg/%E7%AD%89%E5%80%99%E7%90%86%E8%AB%96>https://zh.m.wikipedia.org/zh-sg/%E7%AD%89%E5%80%99%E7%90%86%E8%AB%96</a></p></blockquote><h3 id=基本统计指标>基本统计指标</h3><p>平均值、标准方差、百分位数、中位数、变异系数、多重模态分布、异常值，这些都是数理统计的基本概念，不赘述了。</p><h1 id=4第一章第二章小结>4.第一章/第二章小结</h1><ul><li><strong>未知的未知</strong>：Brendan Gregg的观点很赞，知道的越多就更容易知道自己的无知。</li><li><strong>性能工程的视角</strong>：利用操作系统的工具链定位出CPU/内存/IO/网络的瓶颈找到性能切入点，进而定位到应用程序的进程/线程，虽然技能要求高，但能获得逻辑自洽的逻辑链，比撞大运靠谱。</li><li><strong>性能工程的工程方法依托于数学</strong>：阿姆达尔定律、通用扩展定律、排队论，世界的尽头果然是数学啊。</li></ul><h1 id=5参考文献>5.参考文献</h1><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-fallback data-lang=fallback>《性能之巅》第一章、第二章
</code></pre></td></tr></table></div></div></div><div class=post-copyright><p class=copyright-item><span class=item-title>文章作者</span>
<span class=item-content>猴王无敌</span></p><p class=copyright-item><span class=item-title>上次更新</span>
<span class=item-content>2022-05-25</span></p><p class=copyright-item><span class=item-title>许可协议</span>
<span class=item-content><a rel="license noopener" href=https://creativecommons.org/licenses/by-nc-nd/4.0/ target=_blank>CC BY-NC-ND 4.0</a></span></p></div><div class=post-reward><input type=checkbox name=reward id=reward hidden>
<label class=reward-button for=reward>赞赏支持</label><div class=qr-code><label class=qr-code-image for=reward><img class=image src=/weixin.png>
<span>微信打赏</span></label>
<label class=qr-code-image for=reward><img class=image src=/alipay.png>
<span>支付宝打赏</span></label></div></div><footer class=post-footer><div class=post-tags><a href=https://jherculesqz.github.io/tags/%E6%80%A7%E8%83%BD%E6%8B%BE%E9%81%97-%E5%AE%8F%E8%A7%82/>性能拾遗-宏观</a></div><nav class=post-nav><a class=prev href=/post/java%E6%8B%BE%E9%81%97/%E8%BF%90%E8%A1%8C%E6%97%B6%E6%95%B0%E6%8D%AE%E5%8C%BA-%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B-%E5%89%8D%E7%BD%AE%E7%9F%A5%E8%AF%864.%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B%E5%9F%BA%E7%A1%80-1/><i class=iconfont><svg class="icon" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="18" height="18"><path d="M691.908486 949.511495l75.369571-89.491197c10.963703-12.998035 10.285251-32.864502-1.499144-44.378743L479.499795 515.267417l277.93508-310.326815c11.338233-12.190647 11.035334-32.285311-.638543-44.850487l-80.46666-86.564541c-11.680017-12.583596-30.356378-12.893658-41.662889-.716314L257.233596 494.235404c-11.332093 12.183484-11.041474 32.266891.657986 44.844348l80.46666 86.564541c1.772366 1.910513 3.706415 3.533476 5.750981 4.877077l306.620399 321.703933C662.505829 963.726242 680.945807 962.528973 691.908486 949.511495z"/></svg></i><span class="prev-text nav-default">【运行时数据区】-并发编程-前置知识(4.并发编程基础)-1</span>
<span class="prev-text nav-mobile">上一篇</span></a>
<a class=next href=/post/%E5%A4%A7%E6%95%B0%E6%8D%AE%E6%8B%BE%E9%81%97/%E5%AE%8F%E8%A7%82-0-%E6%B5%85%E8%B0%88%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/><span class="next-text nav-default">【宏观】-0-浅谈数据仓库</span>
<span class="prev-text nav-mobile">下一篇</span>
<i class=iconfont><svg class="icon" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="18" height="18"><path d="M332.091514 74.487481l-75.369571 89.491197c-10.963703 12.998035-10.285251 32.864502 1.499144 44.378743l286.278095 300.375162L266.565125 819.058374c-11.338233 12.190647-11.035334 32.285311.638543 44.850487l80.46666 86.564541c11.680017 12.583596 30.356378 12.893658 41.662889.716314l377.434212-421.426145c11.332093-12.183484 11.041474-32.266891-.657986-44.844348l-80.46666-86.564541c-1.772366-1.910513-3.706415-3.533476-5.750981-4.877077L373.270379 71.774697C361.493148 60.273758 343.054193 61.470003 332.091514 74.487481z"/></svg></i></a></nav></footer></article></div></div></main><footer id=footer class=footer><div class=icon-links><a href=mailto:JHercules_qz@qq.com rel="me noopener" class=iconfont title=email><svg class="icon" viewBox="0 0 1451 1024" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="36" height="36"><path d="M664.781909 681.472759.0 97.881301C0 3.997201 71.046997.0 71.046997.0H474.477909 961.649408 1361.641813S1432.688811 3.997201 1432.688811 97.881301L771.345323 681.472759S764.482731 685.154773 753.594283 688.65053V688.664858C741.602731 693.493018 729.424896 695.068979 718.077952 694.839748 706.731093 695.068979 694.553173 693.493018 682.561621 688.664858V688.65053C671.644501 685.140446 664.781909 681.472759 664.781909 681.472759zM718.063616 811.603883C693.779541 811.016482 658.879232 802.205449 619.10784 767.734955 542.989056 701.759633.0 212.052267.0 212.052267V942.809523L83.726336 1024H682.532949 753.579947 1348.948139L1432.688811 942.809523V212.052267S893.138176 701.759633 817.019477 767.734955C777.248 802.205449 742.347691 811.03081 718.063616 811.603883z"/></svg></a><a href=https://github.com/JHerculesqz rel="me noopener" class=iconfont title=github target=_blank><svg class="icon" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="36" height="36"><path d="M512 12.672c-282.88.0-512 229.248-512 512 0 226.261333 146.688 418.133333 350.08 485.76 25.6 4.821333 34.986667-11.008 34.986667-24.618667.0-12.16-.426667-44.373333-.64-87.04-142.421333 30.890667-172.458667-68.693333-172.458667-68.693333C188.672 770.986667 155.008 755.2 155.008 755.2c-46.378667-31.744 3.584-31.104 3.584-31.104 51.413333 3.584 78.421333 52.736 78.421333 52.736 45.653333 78.293333 119.850667 55.68 149.12 42.581333 4.608-33.109333 17.792-55.68 32.426667-68.48-113.706667-12.8-233.216-56.832-233.216-253.013333.0-55.893333 19.84-101.546667 52.693333-137.386667-5.76-12.928-23.04-64.981333 4.48-135.509333.0.0 42.88-13.738667 140.8 52.48 40.96-11.392 84.48-17.024 128-17.28 43.52.256 87.04 5.888 128 17.28 97.28-66.218667 140.16-52.48 140.16-52.48 27.52 70.528 10.24 122.581333 5.12 135.509333 32.64 35.84 52.48 81.493333 52.48 137.386667.0 196.693333-119.68 240-233.6 252.586667 17.92 15.36 34.56 46.762667 34.56 94.72.0 68.522667-.64 123.562667-.64 140.202666.0 13.44 8.96 29.44 35.2 24.32C877.44 942.592 1024 750.592 1024 524.672c0-282.752-229.248-512-512-512"/></svg></a><a href=https://jherculesqz.github.io/index.xml rel="noopener alternate" type=application/rss+xml class=iconfont title=rss target=_blank><svg class="icon" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="30" height="30"><path d="M819.157333 1024C819.157333 574.592 449.408 204.8.0 204.8V0c561.706667.0 1024 462.293333 1024 1024H819.157333zM140.416 743.04a140.8 140.8.0 01140.501333 140.586667A140.928 140.928.0 01140.074667 1024C62.72 1024 0 961.109333.0 883.626667S62.933333 743.082667 140.416 743.04zM678.784 1024h-199.04c0-263.210667-216.533333-479.786667-479.744-479.786667V345.173333c372.352.0 678.784 306.517333 678.784 678.826667z"/></svg></a></div><div class=copyright><span class=power-by>Powered by <a class=hexo-link href=https://gohugo.io>Hugo</a></span>
<span class=division>|</span>
<span class=theme-info>Theme - <a class=theme-link href=https://github.com/xianmin/hugo-theme-jane>Jane</a></span>
<span class=copyright-year>&copy;
2021 -
2024
<span class=heart><i class=iconfont><svg class="icon" viewBox="0 0 1025 1024" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="14" height="14"><path d="M1000.1 247.9c-15.5-37.3-37.6-70.6-65.7-98.9-54.4-54.8-125.8-85-201-85-85.7.0-166 39-221.4 107.4C456.6 103 376.3 64 290.6 64c-75.1.0-146.5 30.4-201.1 85.6-28.2 28.5-50.4 61.9-65.8 99.3-16 38.8-24 79.9-23.6 122.2.7 91.7 40.1 177.2 108.1 234.8 3.1 2.6 6 5.1 8.9 7.8 14.9 13.4 58 52.8 112.6 102.7 93.5 85.5 209.9 191.9 257.5 234.2 7 6.1 15.8 9.5 24.9 9.5 9.2.0 18.1-3.4 24.9-9.5 34.5-30.7 105.8-95.9 181.4-165 74.2-67.8 150.9-138 195.8-178.2 69.5-57.9 109.6-144.4 109.9-237.3.1-42.5-8-83.6-24-122.2z" fill="#8a8a8a"/></svg></i></span><span class=author>猴王无敌</span></span>
<span id=busuanzi_container>访客数/访问量：<span id=busuanzi_value_site_uv></span>/<span id=busuanzi_value_site_pv></span></span></div></footer><div class=back-to-top id=back-to-top><i class=iconfont><svg class="icon" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="35" height="35"><path d="M510.866688 227.694839 95.449397 629.218702h235.761562L329.15309 958.01517h362.40389L691.55698 628.188232l241.942331-3.089361L510.866688 227.694839zM63.840492 63.962777h894.052392v131.813095H63.840492V63.962777zm0 0"/></svg></i></div></div><script type=text/javascript src=/lib/jquery/jquery-3.2.1.min.js></script><script type=text/javascript src=/lib/slideout/slideout-1.0.1.min.js></script><script type=text/javascript src=/js/main.638251f4230630f0335d8c6748e53a96f94b72670920b60c09a56fdc8bece214.js integrity="sha256-Y4JR9CMGMPAzXYxnSOU6lvlLcmcJILYMCaVv3Ivs4hQ=" crossorigin=anonymous></script><script type=text/javascript src=/js/load-photoswipe.js></script><script type=text/javascript src=/lib/photoswipe/photoswipe.min.js></script><script type=text/javascript src=/lib/photoswipe/photoswipe-ui-default.min.js></script><script async src=//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js></script></body></html>